<app-source-accounts [accountRequest]="sourceAccountDto" [disabled]="isDisabledForm"
  (onChange)="handleSourceAccountChanged($event)" [defaultAccount]="batchInformation.sourceAccountId" #sourceAccount>
</app-source-accounts>
<div class="row historical__period">
  <div class="col-md-12">
    <app-bar-route></app-bar-route>
    <h4 class="historical__h4">Selecciona cuenta destino</h4>
    <div class="row historical__period-options">
      <div class="col-md-12">
        <app-button-group (onChange)="handleGroupChanged($event)">
          <app-button-group-content [disabled]="isDisabledForm" [contentTitle]="'Mis cuentas'">
            <app-source-accounts [showBarRoute]="false" [accountRequest]="targetAccountDto"
              [accountDropLabel]="'Cuenta destino'" [companyAccounts]="true" [onlyCurrencyBOL]="onlyCurrencyBOL"
              (onChange)="handleDestinationAccountChanged($event)" [disabled]="isDisabledForm" #targetAccount>
            </app-source-accounts>
          </app-button-group-content>
          <app-button-group-content [disabled]="isDisabledForm" [contentTitle]="'Mis favoritos'">
            <app-favorite-transfers [batchInformation]="batchInformation" [interbankAccountInformation]="interbankAccountInformation" 
            [disabled]="isDisabledForm">
            </app-favorite-transfers>
          </app-button-group-content>
          <app-button-group-content [disabled]="isDisabledForm" [contentTitle]="'Cuenta terceros BCP'">
            <app-search-accounts (onChange)="handleDestinationAccountChanged($event)" [disabled]="isDisabledForm" [currency]="batchInformation.currency"
              [accountNumber]="batchInformation.destinationAccount" [sourceCurrency]="batchInformation.sourceCurrency"
              (onSaveFavoriteChange)="handleSaveFavoriteChanged($event)" [groupIndex]="groupIndex"></app-search-accounts>
          </app-button-group-content>
          <app-button-group-content [contentTitle]="'Cuenta terceros ACH'" [disabled]="isDisabledForm">
            <app-interbank-accounts [disabled]="isDisabledForm" [branchOffices]="branchOffices" [banks]="banks"
              [(ngModel)]="interbankAccountInformation" (onSaveFavoriteChange)="handleSaveFavoriteChanged($event)">
            </app-interbank-accounts>
          </app-button-group-content>
        </app-button-group>
      </div>
    </div>
  </div>
</div>
<app-currency-and-amount [disabled]="isDisabledForm" [amount]="batchInformation.amount" [groupIndex]="groupIndex" [isCashOnlineNew]="isCashOnlineNew"
  [isAmountDisabled]="isAmountDisabled" [currency]="batchInformation.currency" [currencies]="currencies" [sameCurrency]="isValidateCurreny"
  [sourceCurrency]="batchInformation.sourceCurrency" [batchInformation]="batchInformation" [isFlagVisible]="false"
  (isShowFundsForm)="isShowFundsForm($event);" #currencyAndAmount></app-currency-and-amount>
<app-approvers-and-controllers [approversRequest]="approversDto" [currency]="batchInformation.currency"
  [amount]="batchInformation.amount" [disabled]="isDisabledForm"
  (onChange)="handleApproversOrControllersChanged($event)" #approversAndControllers></app-approvers-and-controllers>
<app-emails-input [disabled]="isDisabledForm" [batchInformation]="batchInformation" #emailInput></app-emails-input>
<div class="row transferencia-ext__submit">
  <div class="col-md-3 col-sm-4">
    <button class="button__principal historical__button-secondary" [disabled]="isTransferSuccessful"
      (click)="handleValidate(currencyAndAmount.handleValidate()!,approversAndControllers.handleValidate(), approversAndControllers.validateApproversLimit(), emailInput.handleValidate()!, sourceAccount.handleValidate()!,false)">
      PREPARAR TRANSACCIÓN
    </button>
  </div>
  <div class="col-md-3 col-sm-4" *ngIf="is_validbatchtoken">
    <button class="button__pre_save historical__button-secondary" [disabled]="isTransferSuccessful"
      (click)="handleValidate(currencyAndAmount.handleValidate()!,approversAndControllers.handleValidate(), approversAndControllers.validateApproversLimit(), emailInput.handleValidate()!, sourceAccount.handleValidate()!,true)">
      ENVIAR A PREPARACIÓN MASIVA
    </button>
  </div>
  <div class="col-md-2 col-sm-4">
    <button class="button__secondary historical__button-secondary button-program"
      (click)="handleValidateForScheduleOperation(currencyAndAmount.handleValidate()!,approversAndControllers.handleValidate(), approversAndControllers.validateApproversLimit(), emailInput.handleValidate()!, sourceAccount.handleValidate()!,true)"
      [disabled]="batchInformation.isTicket || isTransferSuccessful">
      <em class="fas fa-calendar-alt"></em> PROGRAMAR
    </button>
  </div>
  <div class="col-md-3 col-sm-4">
    <p class="historical__p--cancel" *ngIf="!isTransferSuccessful"><a [routerLink]="['']">CANCELAR</a></p>
    <p class="historical__p--cancel" *ngIf="isTransferSuccessful"><a [routerLink]="['/transfers/national']">NUEVO</a>
    </p>
  </div>
</div>
<app-date-future [visible]="scheduleOperation" (onClose)="scheduleOperation=false"
  (onChange)="handleDateFuture($event)"></app-date-future>
<app-token-modal [disabled]="isTokenFormDisabled" [isVisible]="isVisibleToken" (onSubmit)="handleTokenSubmit($event)"
  (onClose)="isVisibleToken=false"
  [message]="'Necesitamos que ingrese su número Token para confirmar la transferencia.'"></app-token-modal>
<app-modal [visible]="excedeedAmount" (onClose)="excedeedAmount=false" [size]="'md'">
  <div class="app-modal-header col-md-12 col-sm-12">Saldo insuficiente </div>
  <div class="app-modal-body col-md-12 col-sm-12">Estimado cliente, su operación será rechazada si no cuenta con fondos suficientes al
    momento de realizar la autorización.</div>
  <div class="app-modal-footer col-md-12 col-sm-12">
    <div class="offset-md-3 col-md-6 col-xs-12">
      <button class="button__principal modal__button" (click)="excedeedAmount=false; validationCismart()">Aceptar</button>
    </div>
  </div>
</app-modal>

<div *ngIf="!showMessageIsBlock">
  <app-successful-operation-modal [processBatchId]="processBatchNumber" [isSuccessful]="isTransferSuccessful" 
[isTransferType]="isTransferSuccessful" [operationTypeId]="batchInformation.operationTypeId">
</app-successful-operation-modal>
</div>


<app-modal-is-block [showMessageIsBlock]="showMessageIsBlock" (onClose)="onClose($event);"></app-modal-is-block>
<app-pre-preparer-modal [isPreSave]="isPreSave" (prePreparer)="handleIsPreparer($event);"></app-pre-preparer-modal>

<div class="alert alert-primary d-flex align-items-center" role="alert">
  <h5>Estimado cliente, le informamos que las plataformas transaccionales o personas que se dedican a la venta y comercialización de Activos Virtuales, no se encuentran bajo control, supervisión ni regulación de ASFI, razón por lo cual, las transacciones con los mismos son realizadas a riesgo del consumidor financiero. </h5>
</div>